import{r as n,j as e,W as $}from"./index-ChFdzazs.js";import{e as F,P as N,p as L,u as B,c as Y,h as T,f as U,S as W,A as G,m as E,d as H,a as Q}from"./PresetStream-BR2WxA4a.js";const q=(o=15e3)=>{const[m,s]=n.useState(!0),[c,h]=n.useState(null),r=n.useRef(null),_=n.useRef(null),t=n.useRef(!1),l=n.useRef(null),p=async()=>{if(t.current){console.log("Heartbeat: Ping already in progress, skipping");return}t.current=!0;try{l.current&&l.current.abort(),l.current=new AbortController,(await F.get("/api/ping",{timeout:8e3,signal:l.current.signal})).status===200&&(s(!0),h(new Date),_.current&&clearTimeout(_.current),_.current=window.setTimeout(()=>{s(!1),console.warn("Heartbeat timeout - connection lost")},3e4))}catch(d){d.name==="AbortError"||d.code==="ECONNABORTED"?console.log("Heartbeat: Request aborted or timed out"):console.error("Heartbeat failed:",d.message||d),s(!1)}finally{t.current=!1,l.current=null}};return n.useEffect(()=>(p(),r.current=window.setInterval(p,o),()=>{r.current&&(clearInterval(r.current),r.current=null),_.current&&(clearTimeout(_.current),_.current=null),l.current&&(l.current.abort(),l.current=null),t.current=!1}),[o]),{isOnline:m,lastPing:c,reconnect:()=>{t.current||(console.log("Heartbeat: Manual reconnect initiated"),p())}}},R=({direction:o,setDirection:m})=>{const s=n.useRef(null),c=u=>{s.current=u.touches[0].clientY},h=u=>{if(s.current===null)return;const d=u.touches[0].clientY-s.current;p(d)},r=()=>{m("neutral"),s.current=null},_=u=>{s.current=u.clientY,window.addEventListener("mousemove",t),window.addEventListener("mouseup",l)},t=u=>{if(s.current===null)return;const d=u.clientY-s.current;p(d)},l=()=>{m("neutral"),s.current=null,window.removeEventListener("mousemove",t),window.removeEventListener("mouseup",l)},p=u=>{u<-20?m("up"):u>20?m("down"):m("neutral")};return e.jsxs("div",{className:`zoom-wrapper ${o==="up"?"active-up":""} ${o==="down"?"active-down":""}`,children:[e.jsx("div",{className:"zoom-label",children:"+"}),e.jsx("div",{className:`zoom-thumb ${o==="up"?"up":o==="down"?"down":""}`,onTouchStart:c,onTouchMove:h,onTouchEnd:r,onMouseDown:_}),e.jsx("div",{className:"zoom-label",children:"−"})]})},J=()=>e.jsx("svg",{width:"18",height:"9",viewBox:"0 0 18 9",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M17.5063 1.60462C17.8119 1.29904 17.8329 0.780626 17.5533 0.446703C17.2737 0.112781 16.7993 0.089802 16.4937 0.395378L11.3221 5.56695C10.0466 6.84244 7.95341 6.84244 6.67791 5.56695L1.50633 0.395378C1.20075 0.0898024 0.726345 0.112782 0.44671 0.446705C0.167074 0.780628 0.188103 1.29904 0.49368 1.60462L5.66526 6.77619C7.51396 8.62489 10.4861 8.62489 12.3348 6.77619L17.5063 1.60462Z",fill:"white","fill-opacity":"0.64"})}),K=()=>e.jsx("svg",{width:"9",height:"18",viewBox:"0 0 9 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M8.53034 1.53033C8.82323 1.23744 8.82323 0.762563 8.53034 0.46967C8.23744 0.176777 7.76257 0.176777 7.46968 0.46967L2.2981 5.64125C0.443112 7.49624 0.443114 10.5038 2.29811 12.3588L7.46968 17.5303C7.76257 17.8232 8.23744 17.8232 8.53034 17.5303C8.82323 17.2374 8.82323 16.7626 8.53034 16.4697L3.35877 11.2981C2.08956 10.0289 2.08956 7.97112 3.35876 6.70191L8.53034 1.53033Z",fill:"white","fill-opacity":"0.64"})}),X=()=>e.jsx("svg",{width:"18",height:"9",viewBox:"0 0 18 9",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M6.70191 3.35864C7.97112 2.08944 10.0289 2.08944 11.2981 3.35864L16.4697 8.53021C16.7626 8.82311 17.2374 8.82311 17.5303 8.53021C17.8232 8.23732 17.8232 7.76245 17.5303 7.46955L12.3588 2.29798C10.5038 0.442992 7.49624 0.44299 5.64125 2.29798L0.46967 7.46955C0.176777 7.76245 0.176777 8.23732 0.46967 8.53021C0.762563 8.82311 1.23744 8.82311 1.53033 8.53021L6.70191 3.35864Z",fill:"white","fill-opacity":"0.64"})}),ee=()=>e.jsx("svg",{width:"9",height:"18",viewBox:"0 0 9 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M1.53033 0.46967C1.23744 0.176777 0.762564 0.176777 0.46967 0.46967C0.176777 0.762563 0.176777 1.23744 0.46967 1.53033L5.64124 6.70191C6.91045 7.97112 6.91045 10.0289 5.64124 11.2981L0.46967 16.4697C0.176777 16.7626 0.176777 17.2374 0.46967 17.5303C0.762563 17.8232 1.23744 17.8232 1.53033 17.5303L6.7019 12.3588C8.55689 10.5038 8.55689 7.49624 6.70191 5.64125L1.53033 0.46967Z",fill:"white","fill-opacity":"0.64"})}),Z=({isPressed:o,setIsPressed:m})=>{const s=n.useCallback(t=>{m(t)},[m]),c=n.useCallback(t=>{o===t&&m(null)},[o,m]),h=(t,l)=>{s(l)},r=(t,l)=>{t.preventDefault(),c(l)},_=t=>{if(!t)return"";if(t==="up")return"joystick-container-press-up";if(t==="down")return"joystick-container-press-down";if(t==="left")return"joystick-container-press-left";if(t==="right")return"joystick-container-press-right"};return e.jsxs("div",{className:`joystick-container ${_(o)}`,children:[e.jsx("button",{className:`joystick-button  ${o==="up"?"pressed":""}`,onTouchStart:t=>h(t,"up"),onTouchEnd:t=>r(t,"up"),onMouseDown:()=>s("up"),onMouseUp:()=>c("up"),onMouseLeave:()=>c("up"),children:e.jsx(X,{})}),e.jsx("button",{className:`joystick-button ${o==="left"?"pressed":""}`,onTouchStart:t=>h(t,"left"),onTouchEnd:t=>r(t,"left"),onMouseDown:()=>s("left"),onMouseUp:()=>c("left"),onMouseLeave:()=>c("left"),children:e.jsx(K,{})}),e.jsx("button",{className:`joystick-button ${o==="right"?"pressed":""}`,onTouchStart:t=>h(t,"right"),onTouchEnd:t=>r(t,"right"),onMouseDown:()=>s("right"),onMouseUp:()=>c("right"),onMouseLeave:()=>c("right"),children:e.jsx(ee,{})}),e.jsx("button",{className:`joystick-button ${o==="down"?"pressed":""}`,onTouchStart:t=>h(t,"down"),onTouchEnd:t=>r(t,"down"),onMouseDown:()=>s("down"),onMouseUp:()=>c("down"),onMouseLeave:()=>c("down"),children:e.jsx(J,{})})]})},te="_wrapper_am94c_2",ne="_managementBlock_am94c_15",se="_tvManagement_am94c_23",ae="_tvManagement__left_am94c_33",re="_tvManagement__left__icon_am94c_37",oe="_tvManagement__left__text_am94c_47",le="_smallCamera_am94c_58",ce="_smallCamera__left_am94c_68",ie="_smallCamera__left__icon_am94c_72",me="_smallCamera__left__text_am94c_82",ue="_smallCamera__managing_am94c_88",de="_cameraBlock_am94c_96",_e="_miniCameras_am94c_104",he="_miniCameras__camera_am94c_108",pe="_cameraBlock__current_am94c_136",xe="_currentBorderSvg_am94c_145",fe="_cameraBlock__current__hls_am94c_157",a={wrapper:te,managementBlock:ne,tvManagement:se,tvManagement__left:ae,tvManagement__left__icon:re,tvManagement__left__text:oe,smallCamera:le,smallCamera__left:ce,smallCamera__left__icon:ie,smallCamera__left__text:me,smallCamera__managing:ue,cameraBlock:de,miniCameras:_e,miniCameras__camera:he,cameraBlock__current:pe,currentBorderSvg:xe,cameraBlock__current__hls:fe},ge=()=>e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M18 3H6C3.79086 3 2 4.79086 2 7V15C2 17.2091 3.79086 19 6 19H18C20.2091 19 22 17.2091 22 15V7C22 4.79086 20.2091 3 18 3ZM6 4.5H18C19.3807 4.5 20.5 5.61929 20.5 7V15C20.5 16.3807 19.3807 17.5 18 17.5H6C4.61929 17.5 3.5 16.3807 3.5 15V7C3.5 5.61929 4.61929 4.5 6 4.5Z",fill:"#363538"}),e.jsx("path",{d:"M10 19.25C9.58579 19.25 9.25 19.5858 9.25 20C9.25 20.4142 9.58579 20.75 10 20.75H14C14.4142 20.75 14.75 20.4142 14.75 20C14.75 19.5858 14.4142 19.25 14 19.25H10Z",fill:"#363538"})," "]}),ve=()=>e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M7 5.25C4.37665 5.25 2.25 7.37665 2.25 10V14C2.25 16.6234 4.37665 18.75 7 18.75H14.5C16.3087 18.75 17.8535 17.6202 18.4671 16.0278L19.2626 16.8232C20.365 17.9257 22.25 17.1449 22.25 15.5858V8.41421C22.25 6.85513 20.365 6.07434 19.2626 7.17678L18.4671 7.97221C17.8535 6.37983 16.3087 5.25 14.5 5.25H7ZM20.3232 15.7626L18.75 14.1893V9.81066L20.3232 8.23744C20.4807 8.07995 20.75 8.19149 20.75 8.41421V15.5858C20.75 15.8085 20.4807 15.9201 20.3232 15.7626ZM3.75 10C3.75 8.20507 5.20507 6.75 7 6.75H14.5C16.0188 6.75 17.25 7.98122 17.25 9.5V14.5C17.25 16.0188 16.0188 17.25 14.5 17.25H7C5.20507 17.25 3.75 15.7949 3.75 14V10Z",fill:"#363538"})}),je=()=>{const[o,m]=n.useState(!1),{setNotification:s}=$(),[c,h]=n.useState(null),[r,_]=n.useState({text:"Большая/малая операционные Quad",type:N.first}),[t,l]=n.useState(L.filter(i=>i.type!==N.first)),[p,u]=n.useState("neutral"),[d,I]=n.useState("neutral"),[C,O]=n.useState(null),[w,A]=n.useState(null),[P,D]=n.useState(!1),{isOnline:j,lastPing:M,reconnect:V}=q(15e3);//!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!HeartBeat
const x=B("cam1"),f=B("cam2"),z=async i=>{const y={...r},v=L.find(b=>b.type===i);v&&(h(v),_(v),await Q(500),l(b=>b.map(S=>S.type===v.type?y:S)))},k=n.useCallback(async()=>{try{await Y(r.type)}catch(i){console.log(i),s({text:T(i),type:"error",visible:!0})}},[s,r]);n.useEffect(()=>{k()},[k]),n.useEffect(()=>{x.handleZoom(p)},[p,x.handleZoom]),n.useEffect(()=>{f.handleZoom(d)},[d,f.handleZoom]),n.useEffect(()=>{x.handleMove(C)},[C,x.handleMove]),n.useEffect(()=>{f.handleMove(w)},[w,f.handleMove]);const g=n.useCallback(async i=>{try{m(!0),await U(i?"on":"off"),D(i)}catch(y){s({visible:!0,type:"error",text:T(y)})}finally{m(!1)}},[s]);return n.useEffect(()=>(g(!0),()=>{g(!1)}),[g]),e.jsxs("div",{className:a.wrapper,children:[e.jsxs("div",{style:{position:"fixed",top:10,right:10,padding:"8px 12px",backgroundColor:j?"#4CAF50":"#f44336",color:"white",borderRadius:"4px",fontSize:"12px",zIndex:1e3,fontFamily:"Arial, sans-serif"},children:[j?"🟢 Онлайн":"🔴 Оффлайн",M&&e.jsx("div",{style:{fontSize:"10px",marginTop:"2px"},children:M.toLocaleTimeString()})]}),!j&&e.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"rgba(0,0,0,0.9)",color:"white",padding:"30px",borderRadius:"12px",textAlign:"center",zIndex:1001,minWidth:"300px",boxShadow:"0 4px 20px rgba(0,0,0,0.5)"},children:[e.jsx("h3",{style:{margin:"0 0 15px 0"},children:"⚠️ Потеря связи с сервером"}),e.jsx("p",{style:{margin:"10px 0"},children:"Попытка переподключения..."}),e.jsx("button",{onClick:V,style:{padding:"8px 16px",backgroundColor:"#2196F3",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Переподключиться вручную"})]}),e.jsxs("div",{className:a.managementBlock,children:[e.jsxs("div",{className:a.tvManagement,children:[e.jsxs("div",{className:a.tvManagement__left,children:[e.jsx("div",{className:a.tvManagement__left__icon,children:e.jsx(ge,{})}),e.jsxs("div",{className:a.tvManagement__left__text,children:[e.jsxs("span",{children:[e.jsx("b",{children:"Телевизор"})," "]}),e.jsx("br",{}),e.jsx("span",{children:"Подключен"})]})]}),e.jsx(W,{disabled:o,on:P,setOn:g})]}),e.jsxs("div",{className:a.smallCamera,children:[e.jsxs("div",{className:a.smallCamera__left,children:[e.jsx("div",{className:a.smallCamera__left__icon,children:e.jsx("img",{src:"/icons/camera.png",alt:"camera",fetchPriority:"high"})}),e.jsxs("div",{className:a.smallCamera__left__text,children:[e.jsxs("span",{children:[e.jsx("b",{children:"Малая операционная"})," "]}),e.jsx("br",{}),e.jsx("span",{style:{fontWeight:400,fontSize:"14px",lineHeight:"143%",color:"rgba(255, 255, 255, 0.64)"},children:"Камера 1"})]})]}),e.jsxs("div",{className:a.smallCamera__managing,children:[e.jsx(R,{direction:p,setDirection:u}),e.jsx(Z,{isPressed:C,setIsPressed:O})]})]}),e.jsxs("div",{className:a.smallCamera,children:[e.jsxs("div",{className:a.smallCamera__left,children:[e.jsx("div",{className:a.smallCamera__left__icon,children:e.jsx(ve,{})}),e.jsxs("div",{className:a.smallCamera__left__text,children:[e.jsxs("span",{children:[e.jsx("b",{children:"Большая операционная"})," "]}),e.jsx("br",{}),e.jsx("span",{style:{fontWeight:400,fontSize:"14px",lineHeight:"143%",color:"rgba(255, 255, 255, 0.64)"},children:"Камера 2"})]})]}),e.jsxs("div",{className:a.smallCamera__managing,children:[e.jsx(R,{direction:d,setDirection:I}),e.jsx(Z,{isPressed:w,setIsPressed:A})]})]})]}),e.jsxs("div",{className:a.cameraBlock,children:[e.jsx(G,{mode:"wait",children:e.jsxs(E.div,{initial:{opacity:0,y:-60},animate:{opacity:1,y:0},exit:{opacity:0,x:40},transition:{duration:.5},className:a.cameraBlock__current,children:[e.jsxs("svg",{width:"100%",height:"100%",viewBox:"0 0 703 448",preserveAspectRatio:"none",xmlns:"http://www.w3.org/2000/svg",className:a.currentBorderSvg,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"frameGradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:"#A2B2F7"}),e.jsx("stop",{offset:"50%",stopColor:"#CA97EA"}),e.jsx("stop",{offset:"100%",stopColor:"#90BFFD"})]})}),e.jsx("rect",{x:"4",y:"4",width:"695",height:"440",rx:"32",ry:"32",fill:"none",stroke:"url(#frameGradient)",strokeWidth:"8"})]}),e.jsx("div",{className:a.cameraBlock__current__hls,children:e.jsx(H,{preset:r.type})}),e.jsx("p",{children:r.text})]},r.type)}),e.jsx("div",{className:a.miniCameras,children:t.map(i=>e.jsxs(E.div,{onClick:()=>z(i.type),initial:c?.type===i.type?{opacity:1,y:0}:{opacity:0,y:-40},animate:c?.type===i.type?{opacity:0,y:40}:{opacity:1,y:0},transition:{duration:.4},className:a.miniCameras__camera,children:[e.jsx("div",{children:e.jsx(H,{preset:i.type})}),e.jsx("p",{children:i.text})]},i.type))})]})]})};export{je as default};
